<!--

    A few <audio control>s pointing at web radios

    (c) 2016 John Gliksberg

    There is no guarantee the URLs are valid
    or your browser will display the players correctly.

-->

<html>
  <head>
    <title>radios</title>
    <style type="text/css">
      html {
        font-family: "Courier New", Courier, monospace;
        text-align: center;
        font-size: 30px;
        margin: 2em;
      }
      @media (max-width: 1000px) {
        html {
          font-size: 3vw;
        }
      }
      header > h1 {
        font-weight: normal;
      }
      header > h1 {
        font-size: 2em;
      }
      header > p {
        font-size: 0.6em;
      }
      div#radios {
        display: table;
        margin: 2em auto;
        text-align: right;
      }
      div#radios > p.radio-name,
      div#radios > audio {
        padding: 1em;
        display: inline;
        vertical-align: middle;
      }
    </style>
    <script type="text/javascript">
      function autoplay()
      {
        var firstaudio = document.getElementsByTagName("audio")[0];
        firstaudio.autoplay = true;
        firstaudio.load();
      }
      function initradios() {
        const urls = {
          "TSF Jazz"    : "http://tsfjazz.ice.infomaniak.ch/tsfjazz-high",
          "Radio Nova"  : "http://novazz.ice.infomaniak.ch/novazz-128.mp3",
          "FIP"         : "http://direct.fipradio.fr/live/fip-midfi.mp3",
        };
        const container = document.getElementById("radios");
        first = true;
        for (var radioName in urls)
        {
          if (first)
          {
            first = false;
          }
          else
          {
            const hr = document.createElement("hr");
            container.appendChild(hr);
          }
          // Create radio name <p>
          const nameElt = document.createElement("p");
          nameElt.className += "radio-name";
          const nameText = document.createTextNode(radioName);
          nameElt.appendChild(nameText);
          container.appendChild(nameElt);
          // Create radio stream <audio>
          const audio = document.createElement("audio");
          const controls = document.createAttribute("controls");
          audio.setAttributeNode(controls);
          audio.setAttribute("src", urls[radioName]);
          audio.setAttribute("preload", "none");
          audio.addEventListener("play", function ()
            {
              const audios = document.getElementsByTagName("audio");
              for (var i=0, audio2; audio2 = audios[i]; i++)
              {
                if (audio2.readyState != 0 && // If station is unloaded, skip
                    audio2 != audio)          // If selected station, skip
                {
                  const srcBackup = audio2.src;
                  audio2.src = "";
                  audio2.load();
                  audio2.src = srcBackup;
                }
              }
            });
          container.appendChild(audio);
        }
      }
    </script>
  </head>
  <!-- uncomment to autoplay first radio -->
  <body onLoad="initradios();/*autoplay()*/">
    <header>
      <h1>
        radios
      </h1>
      <p>
        &copy; 2016
        <a href="https://github.com/trosh">
          John Gliksberg
        </a>
      </p>
    </header>
    <div id="radios">
    </div>
  </body>
</html>
